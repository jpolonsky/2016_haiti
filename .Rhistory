plot.title = element_text(size = 12, face = 'bold', color = 'darkblue'),
legend.text = element_text(size = 5, family = 'Palatino', face = 'bold'),
legend.key = element_blank(),
legend.key.size = unit(.4, 'cm'),
axis.text.x = element_text(size = 5),
axis.text.y = element_text(size = 6, face = 'bold'),
legend.position = 'bottom',
legend.title = element_blank(),
axis.ticks = element_blank()
) +
labs(title = '', x = '', y = title)
tmp <-
data %>%
group_by_(facet_var, key) %>%
summarise_(value = lazyeval::interp(~ round(sum(var)), var = as.name(value))) %>%
mutate(prop = round(value/sum(value), 2))
tmp
ggplot(tmp) +
geom_bar(aes_string(x = facet_var, y = 'prop', fill = key), stat = 'identity') +
scale_fill_manual(
values = if(colour_scheme %in% c('viridis', 'Viridis')) viridis::viridis(length(unique(tmp[[key]])))
else colorRampPalette(RColorBrewer::brewer.pal(9, colour_scheme))(length(unique(tmp[[key]])))
) +
scale_y_continuous(labels = scales::percent) +
coord_flip()
ggplot(tmp) +
geom_bar(aes_string(x = facet_var, y = 'prop', fill = key), stat = 'identity') +
scale_fill_manual(
values = if(colour_scheme %in% c('viridis', 'Viridis')) viridis::viridis(length(unique(tmp[[key]])))
else colorRampPalette(RColorBrewer::brewer.pal(9, colour_scheme))(length(unique(tmp[[key]])))
) +
scale_y_continuous(labels = scales::percent) +
coord_flip()
df_pie_cas_vus <- map(list_dat_raw, WrangleDataPie, variable = 'cas_vus')
df_pie_cas_vus
map(df_pie_cas_vus, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune')
tmp <-
data %>%
group_by_(facet_var, key) %>%
summarise_(value = lazyeval::interp(~ round(sum(var)), var = as.name(value))) %>%
mutate(prop = round(value/sum(value), 2))
tmp
ggplot(tmp) +
geom_bar(aes_string(x = facet_var, y = 'prop', fill = key), stat = 'identity') +
scale_fill_manual(
values = if(colour_scheme %in% c('viridis', 'Viridis')) viridis::viridis(length(unique(tmp[[key]])))
else colorRampPalette(RColorBrewer::brewer.pal(9, colour_scheme))(length(unique(tmp[[key]])))
) +
scale_y_continuous(labels = scales::percent) +
coord_flip() +
# ggthemes::theme_tufte(base_family = 'Palatino') +
theme_bw() +
theme(
panel.border = element_blank(),
plot.title = element_text(size = 12, face = 'bold', color = 'darkblue'),
legend.text = element_text(size = 5, family = 'Palatino', face = 'bold'),
legend.key = element_blank(),
legend.key.size = unit(.4, 'cm'),
axis.text.x = element_text(size = 5),
axis.text.y = element_text(size = 6, face = 'bold'),
legend.position = 'bottom',
legend.title = element_blank(),
axis.ticks = element_blank()
) +
labs(title = '', x = '', y = title)
tmp
tmp[[facet_var]] <- factor(tmp[[facet_var]])
ggplot(tmp) +
geom_bar(aes_string(x = facet_var, y = 'prop', fill = key), stat = 'identity') +
scale_fill_manual(
values = if(colour_scheme %in% c('viridis', 'Viridis')) viridis::viridis(length(unique(tmp[[key]])))
else colorRampPalette(RColorBrewer::brewer.pal(9, colour_scheme))(length(unique(tmp[[key]])))
) +
scale_y_continuous(labels = scales::percent) +
coord_flip() +
# ggthemes::theme_tufte(base_family = 'Palatino') +
theme_bw() +
theme(
panel.border = element_blank(),
plot.title = element_text(size = 12, face = 'bold', color = 'darkblue'),
legend.text = element_text(size = 5, family = 'Palatino', face = 'bold'),
legend.key = element_blank(),
legend.key.size = unit(.4, 'cm'),
axis.text.x = element_text(size = 5),
axis.text.y = element_text(size = 6, face = 'bold'),
legend.position = 'bottom',
legend.title = element_blank(),
axis.ticks = element_blank()
) +
labs(title = '', x = '', y = title)
tmp
factor(tmp[[facet_var]])
forcats::fct_rev(tmp[[facet_var]])
tmp <-
data %>%
group_by_(facet_var, key) %>%
summarise_(value = lazyeval::interp(~ round(sum(var)), var = as.name(value))) %>%
mutate(prop = round(value/sum(value), 2))
tmp
tmp[[facet_var]]
tmp[[facet_var]] <- forcats::fct_rev(tmp[[facet_var]])
tmp[[facet_var]]
ggplot(tmp) +
geom_bar(aes_string(x = facet_var, y = 'prop', fill = rev(key)), stat = 'identity') +
scale_fill_manual(
values = if(colour_scheme %in% c('viridis', 'Viridis')) viridis::viridis(length(unique(tmp[[key]])))
else colorRampPalette(RColorBrewer::brewer.pal(9, colour_scheme))(length(unique(tmp[[key]])))
)
ggplot(tmp) +
geom_bar(aes_string(x = facet_var, y = 'prop', fill = rev(key)), stat = 'identity') +
scale_fill_manual(
values = if(colour_scheme %in% c('viridis', 'Viridis')) viridis::viridis(length(unique(tmp[[key]])))
else colorRampPalette(RColorBrewer::brewer.pal(9, colour_scheme))(length(unique(tmp[[key]])))
) +
scale_y_continuous(labels = scales::percent) +
coord_flip() +
# ggthemes::theme_tufte(base_family = 'Palatino') +
theme_bw() +
theme(
panel.border = element_blank(),
plot.title = element_text(size = 12, face = 'bold', color = 'darkblue'),
legend.text = element_text(size = 5, family = 'Palatino', face = 'bold'),
legend.key = element_blank(),
legend.key.size = unit(.4, 'cm'),
axis.text.x = element_text(size = 5),
axis.text.y = element_text(size = 6, face = 'bold'),
legend.position = 'bottom',
legend.title = element_blank(),
axis.ticks = element_blank()
) +
labs(title = '', x = '', y = title)
source('~/OneDrive/who/projects/2016_haiti/functions.R')
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune')
tmp
ggplot(tmp) +
geom_bar(aes_string(x = facet_var, y = 'prop', fill = rev(key)), stat = 'identity') +
scale_fill_manual(
values = if(colour_scheme %in% c('viridis', 'Viridis')) viridis::viridis(length(unique(tmp[[key]])))
else colorRampPalette(RColorBrewer::brewer.pal(9, colour_scheme))(length(unique(tmp[[key]])))
) +
scale_y_continuous(labels = scales::percent) +
coord_flip() +
# ggthemes::theme_tufte(base_family = 'Palatino') +
theme_bw() +
theme(
panel.border = element_blank(),
plot.title = element_text(size = 12, face = 'bold', color = 'darkblue'),
legend.text = element_text(size = 5, family = 'Palatino', face = 'bold'),
legend.key = element_blank(),
legend.key.size = unit(.4, 'cm'),
axis.text.x = element_text(size = 5),
axis.text.y = element_text(size = 6, face = 'bold'),
legend.position = 'bottom',
legend.title = element_blank(),
axis.ticks = element_blank()
) +
labs(title = '', x = '', y = title)
source('~/OneDrive/who/projects/2016_haiti/functions.R')
source('~/OneDrive/who/projects/2016_haiti/functions.R')
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune')
tmp[[key]]
forcats::fct_inorder(tmp[[key]])
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune')
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune')
p
ggplot(tmp) +
geom_bar(aes_string(x = facet_var, y = 'prop', fill = key), stat = 'identity') +
scale_fill_manual(
values = if(colour_scheme %in% c('viridis', 'Viridis')) viridis::viridis(length(unique(tmp[[key]])))
else colorRampPalette(RColorBrewer::brewer.pal(9, colour_scheme))(length(unique(tmp[[key]])))
) +
scale_y_continuous(labels = scales::percent) +
coord_flip() +
# ggthemes::theme_tufte(base_family = 'Palatino') +
theme_bw() +
theme(
panel.border = element_blank(),
plot.title = element_text(size = 12, face = 'bold', color = 'darkblue'),
legend.text = element_text(size = 5, family = 'Palatino', face = 'bold'),
legend.key = element_blank(),
legend.key.size = unit(.4, 'cm'),
axis.text.x = element_text(size = 5),
axis.text.y = element_text(size = 6, face = 'bold'),
legend.position = 'bottom',
legend.title = element_blank(),
axis.ticks = element_blank()
) +
labs(title = '', x = '', y = title)
tmp[[key]]
ggplot(tmp) +
geom_bar(aes_string(x = facet_var, y = 'prop', fill = key), stat = 'identity') +
scale_fill_manual(
values = if(colour_scheme %in% c('viridis', 'Viridis')) viridis::viridis(length(unique(tmp[[key]])))
else colorRampPalette(RColorBrewer::brewer.pal(9, colour_scheme))(length(unique(tmp[[key]])))
) +
scale_y_continuous(labels = scales::percent)
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune')
ggplot(tmp) +
geom_bar(aes_string(x = facet_var, y = 'prop', fill = key), stat = 'identity') +
scale_fill_manual(
values = if(colour_scheme %in% c('viridis', 'Viridis')) viridis::viridis(length(unique(tmp[[key]])))
else colorRampPalette(RColorBrewer::brewer.pal(9, colour_scheme))(length(unique(tmp[[key]])))
) +
scale_y_continuous(labels = scales::percent) +
coord_flip()
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune')
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune')
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune')
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune')
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune')
?guides
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune')
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune')
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune')
map(df_pie_cas_vus, PlotBar, colour_scheme = 'viridis', facet_var = 'commune')
list_pie_age <- map(df_pie_cas_vus, PlotPie, colour_scheme = 'RdBu', facet_var = 'commune')
list_pie_age
map(df_pie_cas_vus, PlotPie, colour_scheme = 'viridis')
map(df_pie_cas_vus, PlotPie, colour_scheme = 'RdBu', key = 'commune')
map(df_pie_cas_vus, PlotPie, colour_scheme = 'viridis')
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotPie, colour_scheme = 'viridis')
tmp
ggplot(tmp) +
geom_bar(
aes_string(x = 1, y = 'prop', fill = key),
width = 1, stat = 'identity', colour = 'white', size = .1
) +
coord_polar('y', start = 0) +
geom_text(
aes(x = 1.75, y = tmp$pos, label = tmp$label),
colour = 'black', family = 'Palatino', size = 1, fontface = 'bold', check_overlap = TRUE
) +
scale_y_continuous(breaks = tmp$pos, labels = NULL) +
scale_fill_manual(
values = if(colour_scheme %in% c('viridis', 'Viridis')) viridis::viridis(length(unique(tmp[[key]])))
else colorRampPalette(RColorBrewer::brewer.pal(9, colour_scheme))(length(unique(tmp[[key]])))
) +
ggthemes::theme_tufte(base_family = 'Palatino') +
theme(
panel.border = element_blank(),
plot.title = element_text(size = 12, face = 'bold', color = 'darkblue'),
legend.key = element_blank(),
legend.position = '',
axis.ticks.y = element_blank(),
axis.text.y = element_blank(),
panel.grid  = element_blank()
) +
labs(x = '', y = '', title = ifelse(title %in% NULL, NULL, paste0(title)))
tmp[[key]]
factor(tmp[[key]], levels = unique(tmp[[key]]))
forcats::fct_inorder(tmp[[key]])
tmp
tmp <-
if(is.null(facet_var)) {
eval(substitute(
data %>%
group_by_(key) %>%
summarise(value_sum = round(sum(colname, na.rm = T))),
list(colname = as.symbol(value)))
) %>%
mutate(prop = round(value_sum/sum(value_sum) * 100, 1))
} else {
eval(substitute(
data %>%
group_by_(facet_var, key) %>%
summarise(value_sum = round(sum(colname, na.rm = T))),
list(colname = as.symbol(value)))
) %>%
group_by_(facet_var) %>%
mutate(prop = round(value_sum/sum(value_sum) * 100, 1))
}
tmp
eval(substitute(
data %>%
group_by_(key) %>%
summarise(value_sum = round(sum(colname, na.rm = T))),
list(colname = as.symbol(value)))
) %>%
mutate(prop = round(value_sum/sum(value_sum) * 100, 1))
tmp <-
if(is.null(facet_var)) {
eval(substitute(
data %>%
group_by_(key) %>%
summarise(value_sum = round(sum(colname, na.rm = T))),
list(colname = as.symbol(value)))
) %>%
mutate(prop = round(value_sum/sum(value_sum) * 100, 1))
} else {
eval(substitute(
data %>%
group_by_(facet_var, key) %>%
summarise(value_sum = round(sum(colname, na.rm = T))),
list(colname = as.symbol(value)))
) %>%
group_by_(facet_var) %>%
mutate(prop = round(value_sum/sum(value_sum) * 100, 1))
}
tmp
tmp <- if (retain.order == T) tmp else arrange(tmp, desc(prop))
tmp
if (length(unique(tmp[[key]])) > 10) {
tmp1 <- tmp[1:7, ]
tmp2 <-
tmp %>%
slice(8:nrow(tmp)) %>%
summarise(value_sum = sum(value_sum)) %>%
mutate(prop = round(value_sum/sum(tmp$value_sum) * 100, 1))
# browser()
tmp1[8, 1] <- 'Other'
tmp1[8, (ncol(tmp1)-1):ncol(tmp1)] <- tmp2
tmp <- tmp1 %>% mutate(pos = cumsum(prop) - 0.5 * prop)
tmp[[key]] <-
factor(tmp[[key]],
levels = c(tmp[[key]][nrow(tmp)],
tmp[[key]][-nrow(tmp)][order(tmp$prop[-nrow(tmp)])]))
} else {
tmp <- mutate(tmp, pos = cumsum(prop) - 0.5 * prop)
tmp[[key]] <- factor(tmp[[key]], levels = unique(tmp[[key]]))
}
tmp
tmp
tmp <- mutate(tmp, pos = cumsum(prop) - 0.5 * prop)
tmp
factor(tmp[[key]], levels = unique(tmp[[key]]))
forcats::fct_inorder(tmp[[key]])
tmp[[key]] <- forcats::fct_inorder(tmp[[key]])
tmp[[key]]
tmp$char_lab <- as.character(tmp[[key]])
TwoLines <- function(x) {
if (nchar(x) > 10) {
x <- gsub(' or ', '/\n', x)
x <- gsub(' ', '\n', x)
} else x
return(x)
}
tmp$char_lab <- sapply(as.list(tmp$char_lab), TwoLines)
for(i in 1:nrow(tmp)) tmp$label[i] <- paste0(tmp[i, 'char_lab'], '\n', tmp[i, 'prop'], '%')
tmp
tmp[[key]]
tmp[[key]] <- forcats::fct_inorder(tmp[[key]])
p <-
if(is.null(facet_var)) {
# browser()
ggplot(tmp) +
geom_bar(
aes_string(x = 1, y = 'prop', fill = key),
width = 1, stat = 'identity', colour = 'white', size = .1
) +
coord_polar('y', start = 0) +
geom_text(
aes(x = 1.75, y = tmp$pos, label = tmp$label),
colour = 'black', family = 'Palatino', size = 1, fontface = 'bold', check_overlap = TRUE
) +
scale_y_continuous(breaks = tmp$pos, labels = NULL) +
scale_fill_manual(
values = if(colour_scheme %in% c('viridis', 'Viridis')) viridis::viridis(length(unique(tmp[[key]])))
else colorRampPalette(RColorBrewer::brewer.pal(9, colour_scheme))(length(unique(tmp[[key]])))
) +
ggthemes::theme_tufte(base_family = 'Palatino') +
theme(
panel.border = element_blank(),
plot.title = element_text(size = 12, face = 'bold', color = 'darkblue'),
legend.key = element_blank(),
legend.position = '',
axis.ticks.y = element_blank(),
axis.text.y = element_blank(),
panel.grid  = element_blank()
) +
labs(x = '', y = '', title = ifelse(title %in% NULL, NULL, paste0(title)))
} else {
ggplot(tmp) +
geom_bar(
aes_string(x = 1, y = 'prop', fill = key),
width = 1, stat = 'identity', colour = 'white', size = .1
) +
coord_polar('y', start = 0) +
facet_wrap(facet_var) +
scale_y_continuous(breaks = tmp$pos, labels = NULL) +
scale_fill_manual(
values = if(colour_scheme %in% c('viridis', 'Viridis')) viridis::viridis(length(unique(tmp[[key]])))
else colorRampPalette(RColorBrewer::brewer.pal(9, colour_scheme))(length(unique(tmp[[key]])))
) +
# ggthemes::theme_tufte(base_family = 'Palatino') +
theme_bw() +
theme(
plot.title = element_text(size = 12, face = 'bold', color = 'darkblue'),
legend.title = element_text(size = 4, family = 'Palatino', face = 'bold'),
legend.text = element_text(size = 3, family = 'Palatino'),
legend.key = element_blank(),
# legend.position = '',
legend.key.size = unit(.2, 'cm'),
axis.ticks.y = element_blank(),
axis.text.y = element_blank(),
strip.text = element_text(size = 3, family = 'Palatino', face = 'bold'),
strip.background = element_rect(fill = 'white'),
panel.grid  = element_blank()
) +
labs(x = '', y = '', title = ifelse(title %in% NULL, NULL, paste0(title)))
}
p
p
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotPie, colour_scheme = 'viridis')
df_pie_cas_vus
df_pie_cas_vus <- map(list_dat_raw, WrangleDataPie, variable = 'cas_vus')
list_pie_age <- map(df_pie_cas_vus, PlotPie, colour_scheme = 'RdBu', facet_var = 'commune')
list_pie_age
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotPie, colour_scheme = 'viridis')
tmp[[key]]
source('~/OneDrive/who/projects/2016_haiti/functions.R')
map(df_pie_cas_vus, PlotPie, colour_scheme = 'viridis')
if(is.null(facet_var)) {
eval(substitute(
data %>%
group_by_(key) %>%
summarise(value_sum = round(sum(colname, na.rm = T))),
list(colname = as.symbol(value)))
) %>%
mutate(prop = round(value_sum/sum(value_sum) * 100, 1))
} else {
eval(substitute(
data %>%
group_by_(facet_var, key) %>%
summarise(value_sum = round(sum(colname, na.rm = T))),
list(colname = as.symbol(value)))
) %>%
group_by_(facet_var) %>%
mutate(prop = round(value_sum/sum(value_sum) * 100, 1))
}
tmp
tmp <-
if(is.null(facet_var)) {
eval(substitute(
data %>%
group_by_(key) %>%
summarise(value_sum = round(sum(colname, na.rm = T))),
list(colname = as.symbol(value)))
) %>%
mutate(prop = round(value_sum/sum(value_sum) * 100, 1))
} else {
eval(substitute(
data %>%
group_by_(facet_var, key) %>%
summarise(value_sum = round(sum(colname, na.rm = T))),
list(colname = as.symbol(value)))
) %>%
group_by_(facet_var) %>%
mutate(prop = round(value_sum/sum(value_sum) * 100, 1))
}
tmp
tmp
tmp
forcats::fct_inorder(tmp[[key]])
tmp
forcats::fct_inorder(tmp[[key]])
tmp$char_lab
tmp
forcats::fct_inorder(tmp[[key]])
tmp
facet_var
ggplot(tmp) +
geom_bar(
aes_string(x = 1, y = 'prop', fill = key),
width = 1, stat = 'identity', colour = 'white', size = .1
)
ggplot(tmp) +
geom_bar(
aes_string(x = 1, y = 'prop', fill = key),
width = 1, stat = 'identity', colour = 'white', size = .1
) +
coord_polar('y', start = 0)
ggplot(tmp) +
geom_bar(
aes_string(x = 1, y = 'prop', fill = key),
width = 1, stat = 'identity', colour = 'white', size = .1
) +
coord_polar('y', start = 0) +
geom_text(
aes(x = 1.75, y = tmp$pos, label = tmp$label),
colour = 'black', family = 'Palatino', size = 1, fontface = 'bold', check_overlap = TRUE
)
tmp
ggplot(tmp) +
geom_bar(
aes_string(x = 1, y = 'prop', fill = key),
width = 1, stat = 'identity', colour = 'white', size = .1
) +
coord_polar('y', start = 0) +
geom_text(
aes(x = 1.75, y = tmp$pos, label = tmp$label)
)
ggplot(tmp) +
geom_bar(
aes_string(x = 1, y = 'prop', fill = key),
width = 1, stat = 'identity', colour = 'white', size = .1
)
