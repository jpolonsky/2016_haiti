dat_post_hurr <-
dat %>%
# slice(1:100) %>%
separate(key, c('date', 'key'), ':') %>%
mutate(
date = as.Date(date),
key = str_replace_all(key, fixed('_<5'), ''),
key = str_replace_all(key, fixed('_5+'), ''),
value = as.numeric(value)
)
dat_post_hurr$key %>% unique()
dat_post_hurr <-
dat %>%
# slice(1:100) %>%
separate(key, c('date', 'key'), ':') %>%
mutate(
date = as.Date(date),
key = str_replace_all(key, fixed('_<5'), ''),
key = str_replace_all(key, fixed('_5+'), ''),
value = as.numeric(value)
) %>%
filter(
date >= '2016-10-03',
date < today()
) %>%
group_by(inst, commune, date, key) %>%
summarise(n = sum(value, na.rm = TRUE))
dat_post_hurr
dat_post_hurr <-
dat %>%
# slice(1:100) %>%
separate(key, c('date', 'key'), ':') %>%
mutate(
date = as.Date(date),
key = str_replace_all(key, fixed('_<5'), ''),
key = str_replace_all(key, fixed('_5+'), ''),
key = str_replace_all(key, 'deces.*', 'deces'),
value = as.numeric(value)
) %>%
filter(
date >= '2016-10-03',
date < today()
) %>%
group_by(inst, commune, date, key) %>%
summarise(n = sum(value, na.rm = TRUE))
dat_post_hurr
dat %>%
# slice(1:100) %>%
separate(key, c('date', 'key'), ':') %>%
mutate(
date = as.Date(date),
# key = str_replace_all(key, fixed('_<5'), ''),
# key = str_replace_all(key, fixed('_5+'), ''),
# key = str_replace_all(key, 'deces.*', 'deces'),
key = str_replace_all(key, c(c(fixed('_<5'), ''), c(fixed('_5+'), '')
value = as.numeric(value)
)
dat %>%
# slice(1:100) %>%
separate(key, c('date', 'key'), ':') %>%
mutate(
date = as.Date(date),
# key = str_replace_all(key, fixed('_<5'), ''),
# key = str_replace_all(key, fixed('_5+'), ''),
# key = str_replace_all(key, 'deces.*', 'deces'),
key = str_replace_all(key, c(c(fixed('_<5'), ''), c(fixed('_5+'), '')))
value = as.numeric(value)
)
dat %>%
# slice(1:100) %>%
separate(key, c('date', 'key'), ':') %>%
mutate(
date = as.Date(date),
# key = str_replace_all(key, fixed('_<5'), ''),
# key = str_replace_all(key, fixed('_5+'), ''),
# key = str_replace_all(key, 'deces.*', 'deces'),
key = str_replace_all(key, c(c(fixed('_<5'), ''), c(fixed('_5+'), ''))),
value = as.numeric(value)
)
dat %>%
# slice(1:100) %>%
separate(key, c('date', 'key'), ':') %>%
mutate(
date = as.Date(date),
# key = str_replace_all(key, fixed('_<5'), ''),
# key = str_replace_all(key, fixed('_5+'), ''),
# key = str_replace_all(key, 'deces.*', 'deces'),
key = str_replace_all(key, c(fixed('_<5'), fixed('_5+')), ''),
value = as.numeric(value)
)
c(fixed('_<5'), fixed('_5+'))
dat_post_hurr
ggplot(dat %>% filter(key %in% 'cas_vus')) +
geom_bar(aes(x = date, y = n), stat = 'identity')
n
ggplot(dat %>% filter(key %in% 'cas_vus')) +
geom_bar(aes(x = date, y = value), stat = 'identity')
dat_post_hurr
ggplot(dat_post_hurr %>% filter(key %in% 'cas_vus')) +
geom_bar(aes(x = date, y = n), stat = 'identity')
ggplot(dat_post_hurr %>% filter(key %in% 'cas_vus')) +
geom_bar(aes(x = date, y = n), stat = 'identity') +
# geom_bar(aes(x = date, y = n, fill = commune), stat = 'identity') +
# scale_fill_viridis(discrete = TRUE) +
# geom_text(
#   data = data %>% group_by(date) %>% summarise(total = sum(n)),
#   aes(x = date, y = total + max(total)/50, label = total), size = 1
# ) +
labs(x = 'Date', y = '# cases') +
# ggthemes::theme_tufte() +
theme_bw() +
theme(
axis.title = element_text(size = 4),
axis.text = element_text(size = 3),
axis.ticks = element_blank()
)
ggplot(dat_post_hurr %>% filter(key %in% 'cas_vus')) +
geom_bar(aes(x = date, y = n), stat = 'identity') +
# geom_bar(aes(x = date, y = n, fill = commune), stat = 'identity') +
# scale_fill_viridis(discrete = TRUE) +
geom_text(
data = dat_post_hurr %>% group_by(date) %>% summarise(total = sum(n)),
aes(x = date, y = total + max(total)/50, label = total), size = 1
) +
labs(x = 'Date', y = '# cases') +
# ggthemes::theme_tufte() +
theme_bw() +
theme(
axis.title = element_text(size = 4),
axis.text = element_text(size = 3),
axis.ticks = element_blank()
)
ggplot(dat_post_hurr %>% filter(key %in% 'cas_vus')) +
geom_bar(aes(x = date, y = n), stat = 'identity') +
# geom_bar(aes(x = date, y = n, fill = commune), stat = 'identity') +
# scale_fill_viridis(discrete = TRUE) +
geom_text(
data = dat_post_hurr %>% group_by(date) %>% summarise(total = sum(n)),
aes(x = date, y = total, label = total), size = 1
) +
labs(x = 'Date', y = '# cases') +
# ggthemes::theme_tufte() +
theme_bw() +
theme(
axis.title = element_text(size = 4),
axis.text = element_text(size = 3),
axis.ticks = element_blank()
)
dat_post_hurr %>% group_by(date) %>% summarise(total = sum(n))
ggplot(dat_post_hurr %>% filter(key %in% 'cas_vus')) +
geom_bar(aes(x = date, y = n), stat = 'identity') +
# geom_bar(aes(x = date, y = n, fill = commune), stat = 'identity') +
# scale_fill_viridis(discrete = TRUE) +
geom_text(
data =
dat_post_hurr %>%
filter(key %in% 'cas_vus') %>%
group_by(date) %>%
summarise(total = sum(n)),
aes(x = date, y = total + max(total)/50, label = total), size = 1
) +
labs(x = 'Date', y = '# cases') +
# ggthemes::theme_tufte() +
theme_bw() +
theme(
axis.title = element_text(size = 4),
axis.text = element_text(size = 3),
axis.ticks = element_blank()
)
ggplot(dat_post_hurr %>% filter(key %in% 'cas_vus')) +
geom_bar(aes(x = date, y = n), stat = 'identity') +
# geom_bar(aes(x = date, y = n, fill = commune), stat = 'identity') +
# scale_fill_viridis(discrete = TRUE) +
geom_text(
data =
dat_post_hurr %>%
filter(key %in% 'cas_vus') %>%
group_by(date) %>%
summarise(total = sum(n)),
aes(x = date, y = total + max(total)/50, label = total), size = 1
) +
labs(x = 'Date', y = '# cases') +
ggthemes::theme_tufte() +
theme_bw() +
theme(
axis.title = element_text(size = 4),
axis.text = element_text(size = 3),
axis.ticks = element_blank()
)
ggplot(dat_post_hurr %>% filter(key %in% 'cas_vus')) +
geom_bar(aes(x = date, y = n), stat = 'identity') +
# geom_bar(aes(x = date, y = n, fill = commune), stat = 'identity') +
# scale_fill_viridis(discrete = TRUE) +
geom_text(
data =
dat_post_hurr %>%
filter(key %in% 'cas_vus') %>%
group_by(date) %>%
summarise(total = sum(n)),
aes(x = date, y = total + max(total)/50, label = total), size = 1
) +
labs(x = 'Date', y = '# cases') +
ggthemes::theme_tufte() +
# theme_bw() +
theme(
axis.title = element_text(size = 4),
axis.text = element_text(size = 3),
axis.ticks = element_blank()
)
ggplot(dat_post_hurr %>% filter(key %in% 'cas_vus')) +
# geom_bar(aes(x = date, y = n), stat = 'identity') +
geom_bar(aes(x = date, y = n, fill = commune), stat = 'identity') +
scale_fill_viridis(discrete = TRUE) +
geom_text(
data =
dat_post_hurr %>%
filter(key %in% 'cas_vus') %>%
group_by(date) %>%
summarise(total = sum(n)),
aes(x = date, y = total + max(total)/50, label = total), size = 1
) +
labs(x = 'Date', y = '# cases') +
ggthemes::theme_tufte() +
# theme_bw() +
theme(
axis.title = element_text(size = 4),
axis.text = element_text(size = 3),
axis.ticks = element_blank()
)
dat_post_hurr
ggplot(dat_post_hurr %>% filter(key %in% 'cas_vus')) +
# geom_bar(aes(x = date, y = n), stat = 'identity') +
geom_bar(aes(x = date, y = n, fill = inst), stat = 'identity') +
scale_fill_viridis(discrete = TRUE) +
geom_text(
data =
dat_post_hurr %>%
filter(key %in% 'cas_vus') %>%
group_by(date) %>%
summarise(total = sum(n)),
aes(x = date, y = total + max(total)/50, label = total), size = 1
) +
labs(x = 'Date', y = '# cases') +
ggthemes::theme_tufte() +
# theme_bw() +
theme(
axis.title = element_text(size = 4),
axis.text = element_text(size = 3),
axis.ticks = element_blank()
)
ggplot(dat_post_hurr %>% filter(key %in% 'cas_vus')) +
geom_bar(aes(x = date, y = n), stat = 'identity') +
# geom_bar(aes(x = date, y = n, fill = inst), stat = 'identity') +
# scale_fill_viridis(discrete = TRUE) +
geom_text(
data =
dat_post_hurr %>%
filter(key %in% 'cas_vus') %>%
group_by(date) %>%
summarise(total = sum(n)),
aes(x = date, y = total + max(total)/50, label = total), size = 1
) +
labs(x = 'Date', y = '# cases') +
ggthemes::theme_tufte() +
# theme_bw() +
theme(
axis.title = element_text(size = 4),
axis.text = element_text(size = 3),
axis.ticks = element_blank()
)
ggplot(dat_post_hurr %>% filter(key %in% 'cas_vus')) +
geom_bar(aes(x = date, y = n), stat = 'identity') +
# geom_bar(aes(x = date, y = n, fill = inst), stat = 'identity') +
# scale_fill_viridis(discrete = TRUE) +
geom_text(
data =
dat_post_hurr %>%
filter(key %in% 'cas_vus') %>%
group_by(date) %>%
summarise(total = sum(n)),
aes(x = date, y = total + max(total)/50, label = total), size = 1
) +
labs(x = 'Date', y = '# cases') +
ggthemes::theme_tufte()
ggplot(dat_post_hurr %>% filter(key %in% 'cas_vus')) +
geom_bar(aes(x = date, y = n), stat = 'identity') +
# geom_bar(aes(x = date, y = n, fill = inst), stat = 'identity') +
# scale_fill_viridis(discrete = TRUE) +
geom_text(
data =
dat_post_hurr %>%
filter(key %in% 'cas_vus') %>%
group_by(date) %>%
summarise(total = sum(n)),
aes(x = date, y = total + max(total)/50, label = total), size = 10
) +
labs(x = 'Date', y = '# cases') +
ggthemes::theme_tufte() +
# theme_bw() +
theme(
axis.title = element_text(size = 4),
axis.text = element_text(size = 3),
axis.ticks = element_blank()
)
ggplot(dat_post_hurr %>% filter(key %in% 'cas_vus')) +
geom_bar(aes(x = date, y = n), stat = 'identity') +
# geom_bar(aes(x = date, y = n, fill = inst), stat = 'identity') +
# scale_fill_viridis(discrete = TRUE) +
geom_text(
data =
dat_post_hurr %>%
filter(key %in% 'cas_vus') %>%
group_by(date) %>%
summarise(total = sum(n)),
aes(x = date, y = total + max(total)/50, label = total), size = 5
) +
labs(x = 'Date', y = '# cases') +
ggthemes::theme_tufte() +
# theme_bw() +
theme(
axis.title = element_text(size = 4),
axis.text = element_text(size = 3),
axis.ticks = element_blank()
)
dat_post_hurr
dat_post_hurr$inst
dat_post_hurr$inst %>% unique
dat
dat_post_hurr <-
dat %>%
separate(key, c('date', 'key'), ':') %>%
mutate(
inst = str_trim(inst),
date = as.Date(date),
key = str_replace_all(key, fixed('_<5'), ''),
key = str_replace_all(key, fixed('_5+'), ''),
key = str_replace_all(key, 'deces.*', 'deces'),
value = as.numeric(value)
) %>%
filter(
!is.na(inst),
inst != 'TOTAL',
date >= '2016-10-03',
date < today()
) %>%
group_by(inst, commune, date, key) %>%
summarise(n = sum(value, na.rm = TRUE))
dat_post_hurr$inst %>% unique
ggplot(
dat_post_hurr %>%
filter(key %in% 'cas_vus')
) +
geom_bar(aes(x = date, y = n), stat = 'identity') +
# geom_bar(aes(x = date, y = n, fill = inst), stat = 'identity') +
# scale_fill_viridis(discrete = TRUE) +
geom_text(
data =
dat_post_hurr %>%
filter(key %in% 'cas_vus') %>%
group_by(date) %>%
summarise(total = sum(n)),
aes(x = date, y = total + max(total)/50, label = total), size = 1
) +
labs(x = 'Date', y = '# cases') +
ggthemes::theme_tufte() +
# theme_bw() +
theme(
axis.title = element_text(size = 4),
axis.text = element_text(size = 3),
axis.ticks = element_blank()
)
ggplot(
dat_post_hurr %>%
filter(key %in% 'cas_vus')
) +
geom_bar(aes(x = date, y = n), stat = 'identity') +
# geom_bar(aes(x = date, y = n, fill = inst), stat = 'identity') +
# scale_fill_viridis(discrete = TRUE) +
geom_text(
data =
dat_post_hurr %>%
filter(key %in% 'cas_vus') %>%
group_by(date) %>%
summarise(total = sum(n)),
aes(x = date, y = total + max(total)/50, label = total), size = 3
) +
labs(x = 'Date', y = '# cases') +
ggthemes::theme_tufte() +
# theme_bw() +
theme(
axis.title = element_text(size = 4),
axis.text = element_text(size = 3),
axis.ticks = element_blank()
)
source('~/OneDrive/who/projects/2016_haiti/functions.R')
dat_post_hurr <- WrangleDataCTC(dept = 'DSGA')
dat_post_hurr
ggplot(
dat_post_hurr %>%
filter(key %in% 'cas_vus')
) +
geom_bar(aes(x = date, y = n), stat = 'identity') +
# geom_bar(aes(x = date, y = n, fill = inst), stat = 'identity') +
# scale_fill_viridis(discrete = TRUE) +
geom_text(
data =
dat_post_hurr %>%
filter(key %in% 'cas_vus') %>%
group_by(date) %>%
summarise(total = sum(n)),
aes(x = date, y = total + max(total)/50, label = total), size = 1
) +
labs(x = 'Date', y = '# cases') +
ggthemes::theme_tufte() +
# theme_bw() +
theme(
axis.title = element_text(size = 4),
axis.text = element_text(size = 3),
axis.ticks = element_blank()
)
PlotHistDayPostHurrCTC <- function(data = NULL){
ggplot(
data %>%
filter(key %in% 'cas_vus')
) +
geom_bar(aes(x = date, y = n), stat = 'identity') +
# geom_bar(aes(x = date, y = n, fill = inst), stat = 'identity') +
# scale_fill_viridis(discrete = TRUE) +
geom_text(
data =
dat_post_hurr %>%
filter(key %in% 'cas_vus') %>%
group_by(date) %>%
summarise(total = sum(n)),
aes(x = date, y = total + max(total)/50, label = total), size = 1
) +
labs(x = 'Date', y = '# cases') +
ggthemes::theme_tufte() +
# theme_bw() +
theme(
axis.title = element_text(size = 4),
axis.text = element_text(size = 3),
axis.ticks = element_blank()
)
}
PlotHistDayPostHurrCTC(dat_post_hurr)
list_dept[1]
list_dat_post_hurr <- map(list_dept[1], WrangleDataCTC)
list_dat_post_hurr
tmp <- map(list_dat_post_hurr, PlotHistDayPostHurrCTC)
tmp
PlotHistDayPostHurrCTC
list_dat_post_hurr
list_dat_post_hurr <- map(list_dept[1], WrangleDataCTC) %>% set_names(list_dept[1])
list_dat_post_hurr
tmp <- map(list_dat_post_hurr, PlotHistDayPostHurrCTC) %>% set_names(list_dept[1])
tmp
list_hist_day_post_hurr <- map(list_dat_post_hurr, PlotHistDayPostHurrCTC) %>% set_names(list_dept[1])
list_hist_day_post_hurr
list_dept <- c('DSGA', 'DSS')
list_dept
dat_post_hurr <- WrangleDataCTC(dept = 'DSS')
sheetnames
sheetnames[str_detect(sheetnames, 'Saisie') == TRUE]
sheet
sheetnames[str_detect(sheetnames, 'Saisie') == TRUE]
source('~/OneDrive/who/projects/2016_haiti/functions.R')
dat_post_hurr <- WrangleDataCTC(dept = 'DSGA')
dat_post_hurr
dat_post_hurr <- WrangleDataCTC(dept = 'DSS')
dat_post_hurr
list_dat_post_hurr <- map(list_dept, WrangleDataCTC) %>% set_names(list_dept)
list_hist_day_post_hurr <- map(list_dat_post_hurr, PlotHistDayPostHurrCTC) %>% set_names(list_dept)
list_hist_day_post_hurr
PlotHistDayPostHurrCTC(list_dat_post_hurr[[1]])
list_dat_post_hurr[[1]]
source('~/OneDrive/who/projects/2016_haiti/functions.R')
PlotHistDayPostHurrCTC(list_dat_post_hurr[[1]])
list_hist_day_post_hurr <- map(list_dat_post_hurr, PlotHistDayPostHurrCTC) %>% set_names(list_dept)
list_hist_day_post_hurr
list_db_paths
list_db_paths
str_detect(list_db_paths, Surveillance Cholera_2015_2016)
str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')
list_db_paths[str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')]
list_db_paths[str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')] %>%
str_replace_all('data/', '')
list_db_paths[str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')] %>%
str_replace_all(c('data/' = ''))
list_db_paths[str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')] %>%
str_replace_all(c('data/' = '', '-Surveillance Cholera_2015_2016.xlsx' = ''))
list_db_paths[str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')] %>%
str_replace_all(c('data/' = '', '-Surveillance Cholera.*' = ''))
list_db_paths[str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')] %>%
str_replace_all(c('data/' = '', '[-/_]Surveillance Cholera.*' = ''))
list_db_paths[str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')] %>%
str_replace_all(c('data/' = '', '[-_]Surveillance Cholera.*' = ''))
list_dept <-
list_db_paths[str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')] %>%
str_replace_all(c('data/' = '', '[-_]Surveillance Cholera.*' = ''))
list_db_paths
list_dept <-
list_db_paths[str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')] %>%
str_replace_all(c('data/' = '', '[-_]Surveillance Cholera.*' = ''))
list_dat_post_hurr <- map(list_dept, WrangleDataCTC) %>% set_names(list_dept)
list_hist_day_post_hurr <- map(list_dat_post_hurr, PlotHistDayPostHurrCTC) %>% set_names(list_dept)
list_dept
list_hist_day_post_hurr
list_dat_post_hurr
list_dat_post_hurr[[1]]
list_dat_post_hurr[[1]]$inst %>% unique()
save.image("~/OneDrive/who/projects/2016_haiti/ws.RData")
