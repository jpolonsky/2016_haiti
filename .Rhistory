# data sets
data = map(data_by_age, MergeAges) %>% set_names(list_depts),
data_pie = map(data_by_age, WrangleDataPie, variable = 'cas_vus') %>% set_names(list_depts),
data_map = map2(data, dept, WrangleDataMapPopAR) %>% set_names(list_depts),
# table
epitable = map(data, MakeTable) %>% set_names(list_depts),
# plots
## epicurves
epicurve_by_day_all = map(data, PlotHistDay) %>% set_names(list_depts),
# epicurve_by_week_all = map(data, PlotHistWeek) %>% set_names(list_depts),
epicurve_by_week_commune = map(data, PlotHistWeekCommune) %>% set_names(list_depts),
epicurve_by_week_inst = map(data, PlotHistWeekInst) %>% set_names(list_depts),
## proportion plots
pie_cases_by_commune = map(data_pie, PlotPie, colour_scheme = 'RdBu', key = 'commune') %>% set_names(list_depts),
bar_cases_by_commune = map(data_pie, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune') %>% set_names(list_depts),
## map
map = map(data_map, MakeMapAR) %>% set_names(list_depts)
)
source('functions.R')
source('functions.R')
list_depts
list_depts <- 'DSGA'
df_nested <-
list_depts %>%
map(WrangleData) %>%
bind_rows() %>%
nest(-c(dept), .key = data_by_age) %>%
mutate(
# data sets
data = map(data_by_age, MergeAges) %>% set_names(list_depts),
data_pie = map(data_by_age, WrangleDataPie, variable = 'cas_vus') %>% set_names(list_depts),
data_map = map2(data, dept, WrangleDataMapPopAR) %>% set_names(list_depts),
# table
epitable = map(data, MakeTable) %>% set_names(list_depts),
# plots
## epicurves
epicurve_by_day_all = map(data, PlotHistDay) %>% set_names(list_depts),
# epicurve_by_week_all = map(data, PlotHistWeek) %>% set_names(list_depts),
epicurve_by_week_commune = map(data, PlotHistWeekCommune) %>% set_names(list_depts),
epicurve_by_week_inst = map(data, PlotHistWeekInst) %>% set_names(list_depts),
## proportion plots
pie_cases_by_commune = map(data_pie, PlotPie, colour_scheme = 'RdBu', key = 'commune') %>% set_names(list_depts),
bar_cases_by_commune = map(data_pie, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune') %>% set_names(list_depts),
## map
map = map(data_map, MakeMapAR) %>% set_names(list_depts)
)
df_nested
df_nested$epicurve_by_week_commune
df_nested
load('ws.RData')
source('functions.R')
list_depts
df_nested
load('ws.RData')
source('functions.R')
list_depts
df_nested
df_nested$epicurve_by_day_all[[list_depts]]
df_nested$epicurve_by_day_all
df_nested[[dept == list_depts]]
df_nested[['dept' == list_depts]]
df_nested['dept' == list_depts]
list_depts
list_depts = 'DSGA'
df_nested['dept' == list_depts]
df_nested[['dept' == list_depts]]
df_nested[df_nested$dept == list_depts]
df_nested[[df_nested$dept == list_depts]]
df_nested[df_nested$dept == list_depts]
df_nested$dept
df_nested$dept==list_depts
df_nested[df_nested$dept %in% list_depts]
df_nested$dept %in% list_depts
df_nested$epitable[df_nested$dept %in% list_depts]
df_nested$epitable[df_nested$dept == list_depts]
df_nested$epitable[dept %in% list_depts]
df_nested$epitable['dept' %in% list_depts]
df_nested$epitable[df_nested$dept == list_depts]
df_nested$epitable[df_nested$dept %in% list_depts]
with(df_nested, epitable[dept %in% list_depts])
df_nested %>% select(epitable)
df_nested %>% filter(dept %in% list_depts) %>% select(epitable)
df_nested %>% filter(dept %in% list_depts) %>% select(epitable) %>% unnest()
df_nested %>% select(epitable) %>% unnest()
df_nested
df_nested %>% filter(dept %in% list_depts) %>% unnest()
df_nested %>% filter(dept %in% list_depts) %>% select(epitable) %>% unnest()
list_depts
display_result <- function(variable, dept = list_depts) df_nested %>% filter(dept %in% dept) %>% select(epitable) %>% unnest()
display_result <- function(variable, dept = list_depts) df_nested %>% filter(dept %in% dept) %>% select(variable) %>% unnest()
display_result
display_result('epicurve_by_day_all')
display_result <- function(variable, dept = list_depts) df_nested %>% filter_(dept %in% dept) %>% select_(variable) %>% unnest()
display_result('epicurve_by_day_all')
df_nested %>% filter(dept %in% list_depts) %>% select(epitable) %>% unnest()
df_nested %>% filter(dept %in% list_depts) %>% select(epicurve_by_day_all) %>% unnest()
df_nested %>% filter(dept %in% list_depts)
df_nested %>% filter(dept %in% list_depts) %>% select(data_by_age) %>% unnest()
display_result('data_by_age')
df_nested %>% filter(dept %in% list_depts) %>% select(epicurve_by_day_all)
df_nested %>% filter(dept %in% list_depts) %>% select(epicurve_by_day_all) %>% print
df_nested %>% filter(dept %in% list_depts) %>% select(data_by_age)
df_nested %>% filter(dept %in% list_depts) %>% select(epicurve_by_day_all) %>% unlist()
df_nested %>% filter(dept %in% list_depts) %>% select(data_by_age) %>% unnest()
df_nested %>% filter(dept %in% list_depts) %>% select(epicurve_by_day_all)
df_nested %>% filter(dept %in% list_depts) %>% select(epicurve_by_day_all)[[1]]
df_nested %>% filter(dept %in% list_depts) %>% select(epicurve_by_day_all)[1]
df_nested %>% filter(dept %in% list_depts) %>% select(data_by_age) %>% unnest()
df_nested %>% select(epicurve_by_day_all) %>% unnest()
df_nested %>% filter(dept %in% list_depts) %>% select(epicurve_by_day_all) %>% unnest()
df_nested %>% filter(dept %in% list_depts) %>% select(data_by_age) %>% unnest()
df_nested %>% filter(dept %in% list_depts) %>% select(epicurve_by_day_all)
tmp <- df_nested %>% filter(dept %in% list_depts) %>% select(epicurve_by_day_all)
tmp
tmp[[1]]
tmp[[2]]
display_result('data_by_age')
display_result <- function(variable, dept = list_depts) df_nested %>% filter_(dept %in% dept) %>% select_(variable)# %>% unnest()
display_result('data_by_age')
display_result('data_by_age') %>% unnest
display_result('data_by_age')[[1]]
list_depts
df_nested %>% filter(dept %in% list_depts)
df_nested %>% filter(dept %in% list_depts) %>% unnest()
df_nested %>% filter(dept %in% list_depts) %>% %>% select(data) %>% unnest()
df_nested %>% filter(dept %in% list_depts) %>% select(data) %>% unnest()
df_nested %>% select(data) %>% unnest()
list_depts
display_result <- function(variable, dept = list_depts) df_nested %>% filter_(dept %in% dept) %>% select_(variable)# %>% unnest()
display_result('data_by_age')[[1]]
display_result('data_by_age')[[1]]
display_result('data_by_age')[[1]][[1]]
display_result <- function(variable, dept = list_depts) df_nested %>% filter_(dept %in% dept) %>% select_(variable) %>% unnest()
display_result('data_by_age')[[1]][[1]]
display_result('data_by_age')[[1]]
display_result('data_by_age')
display_result <- function(variable) df_nested %>% filter(dept %in% list_depts) %>% select_(variable) %>% unnest()
display_result('data_by_age')
df_nested %>% filter(dept %in% list_depts) %>% select(data_by_age) %>% unnest()
df_nested %>% filter(dept %in% list_depts) %>% select(epicurve_by_day_all)
display_result('epicurve_by_day_all')
display_result <- function(variable) df_nested %>% filter(dept %in% list_depts) %>% select_(variable)
display_result('data_by_age')
display_result('data_by_age') %>% unnest()
display_result('epicurve_by_day_all')
display_result('epicurve_by_day_all') %>% unnest()
display_result('epicurve_by_day_all') %>% print()
display_result('epicurve_by_day_all')[[1]]
display_result('epicurve_by_day_all')[[2]]
display_result('pie_cases_by_commune')[[1]]
display_result <- function(variable) df_nested %>% filter(dept %in% list_depts) %>% select_(variable) %>% unnest()
display_result('pie_cases_by_commune')[[1]]
display_result('data_by_age') %>% unnest()
display_result <- function(variable) df_nested %>% filter(dept %in% list_depts) %>% select_(variable)
display_result('data_by_age') %>% unnest()
display_result('pie_cases_by_commune')[[1]]
list_db_paths <- dir('data', full.names = TRUE)
list_depts <-
list_db_paths[str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')] %>%
str_replace_all(c('data/' = '', '[-_]Surveillance Cholera.*' = ''))
list_depts
display_result <- function(variable) df_nested %>% filter(dept %in% list_depts) %>% select_(variable)
display_result('data_by_age') %>% unnest()
display_result('pie_cases_by_commune')[[1]]
?unnest
display_result('data_by_age') %>% unnest(.id = dept)
display_result('data_by_age')
display_result <- function(variable) df_nested %>% filter(dept %in% list_depts) %>% select_('dept', variable)
display_result('data_by_age') %>% unnest(.id = dept)
display_result('data_by_age')
display_result('data_by_age') %>% unnest(.id = 'dept')
display_result('pie_cases_by_commune')[[1]]
display_result('pie_cases_by_commune')
display_result('pie_cases_by_commune')[['pie_cases_by_commune']]
display_result('pie_cases_by_commune') %>% select('pie_cases_by_commune')
display_result('pie_cases_by_commune') %>% select(pie_cases_by_commune)
display_result('pie_cases_by_commune') %>% select(pie_cases_by_commune)[[1]]
display_result('pie_cases_by_commune') %>% select(pie_cases_by_commune)[1]
display_result('pie_cases_by_commune')[[2]]
display_result('data_by_age')[[2]]
display_result('data_by_age')
display_result <- function(variable) df_nested %>% filter(dept %in% list_depts) %>% select_(variable)
display_result('data_by_age')[[2]]
display_result('data_by_age')[[1]]
display_result('pie_cases_by_commune')[[1]]
display_result('data_by_age')
display_result('data_by_age') %>% unnest(.id = 'dept')
display_result('data_by_age')[[2]]
display_result <- function(variable) df_nested %>% filter(dept %in% list_depts) %>% select_('dept', variable)
display_result('data_by_age') %>% unnest(.id = 'dept')
display_result('data_by_age')[[2]]
display_result('data_by_age')
display_result <- function(variable) df_nested %>% filter(dept %in% list_depts) %>% select_(variable)
display_result('data_by_age')[[1]]
display_result('pie_cases_by_commune')[[1]]
list_depts <- 'DSGA'
display_result <- function(variable) df_nested %>% filter(dept %in% list_depts) %>% select_(variable)
display_result('data_by_age')[[1]]
display_result('pie_cases_by_commune')[[1]]
display_result('data_by_age')
display_result('pie_cases_by_commune')
display_result('data_by_age')[[1]]
display_result('pie_cases_by_commune')[[1]]
display_result('epicurve_by_day_all')[[1]]
display_result('epitable')[[1]]
list_depts <- 'DSGA'
source('functions.R')
df_nested <-
list_depts %>%
map(WrangleData) %>%
bind_rows() %>%
nest(-c(dept), .key = data_by_age) %>%
mutate(
# data sets
data = map(data_by_age, MergeAges),
data_pie = map(data_by_age, WrangleDataPie, variable = 'cas_vus'),
data_map = map2(data, dept, WrangleDataMapPopAR),
# table
epitable = map(data, MakeTable),
# plots
## epicurves
epicurve_by_day_all = map(data, PlotHistDay),
# epicurve_by_week_all = map(data, PlotHistWeek),
epicurve_by_week_commune = map(data, PlotHistWeekCommune),
epicurve_by_week_inst = map(data, PlotHistWeekInst),
## proportion plots
pie_cases_by_commune = map(data_pie, PlotPie, colour_scheme = 'RdBu', key = 'commune'),
bar_cases_by_commune = map(data_pie, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune'),
## map
map = map(data_map, MakeMapAR)
)
list_db_paths <- dir('data', full.names = TRUE)
df_nested <-
list_depts %>%
map(WrangleData) %>%
bind_rows() %>%
nest(-c(dept), .key = data_by_age) %>%
mutate(
# data sets
data = map(data_by_age, MergeAges),
data_pie = map(data_by_age, WrangleDataPie, variable = 'cas_vus'),
data_map = map2(data, dept, WrangleDataMapPopAR),
# table
epitable = map(data, MakeTable),
# plots
## epicurves
epicurve_by_day_all = map(data, PlotHistDay),
# epicurve_by_week_all = map(data, PlotHistWeek),
epicurve_by_week_commune = map(data, PlotHistWeekCommune),
epicurve_by_week_inst = map(data, PlotHistWeekInst),
## proportion plots
pie_cases_by_commune = map(data_pie, PlotPie, colour_scheme = 'RdBu', key = 'commune'),
bar_cases_by_commune = map(data_pie, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune'),
## map
map = map(data_map, MakeMapAR)
)
df_nested
DisplayResult('epicurve_by_day_all')[[1]]
DisplayResult('pie_cases_by_commune')[[1]]
DisplayResult('epitable')[[1]]
nrow(DisplayResult('epitable')[[1]])
DisplayResult('epitable')[[1]]
DisplayResult('epitable')[[1]] %>% dim()
DisplayResult('epitable')[[1]][[1]]
DisplayResult('epitable')[[1]][[1]] %>% nrow
DisplayResult('epicurve_by_day_all')[[1]]
DisplayResult('epicurve_by_day_all')[[1]][[1]]
DisplayResult('pie_cases_by_commune')[[1]][[1]]
DisplayResult('pie_cases_by_commune')
DisplayResult <- function(variable) df_nested %>% filter(dept %in% list_depts) %>% select_(variable)
df_nested %>%
filter(dept %in% list_depts) %>%
select(epicurve_by_day_all)
df_nested %>%
filter(dept %in% list_depts) %>%
select(epicurve_by_day_all) %>%
unlist()
df_nested %>%
filter(dept %in% list_depts) %>%
select(epicurve_by_day_all)
df_nested %>%
filter(dept %in% list_depts) %>%
select(epicurve_by_day_all) %$%
levels()
df_nested %>%
filter(dept %in% list_depts) %>%
select(epicurve_by_day_all) %$%
levels
df_nested %>%
filter(dept %in% list_depts) %>%
select(epicurve_by_day_all)
df_nested %>%
filter(dept %in% list_depts) %$%
select(epicurve_by_day_all)
df_nested %>%
filter(dept %in% list_depts) %$%
'epicurve_by_day_all'
df_nested %>%
filter(dept %in% list_depts) %$%
'pie_cases_by_commune'
df_nested %>%
filter(dept %in% list_depts) %$%
'epicurve_by_day_all'
df_nested %>%
filter(dept %in% list_depts) %>%
extract2(epicurve_by_day_all)
df_nested %>%
filter(dept %in% list_depts) %>%
extract2('epicurve_by_day_all')
df_nested %>%
filter(dept %in% list_depts) %>%
extract('epicurve_by_day_all')
?extract2
?is_in
df_nested %>%
filter(dept %in% list_depts) %>%
extract2('epicurve_by_day_all')
df_nested %>%
filter(dept %in% list_depts) %>%
extract2('pie_cases_by_commune')
df_nested %>%
filter(dept %in% list_depts) %>%
extract2('epitable')
df_nested %>%
filter(dept %in% list_depts) %>%
extract2('epitable') %>% nrow
df_nested %>%
filter(dept %in% list_depts) %>%
extract2('epitable') %>%
extract2('nrow')
df_nested %>%
filter(dept %in% list_depts) %>%
extract2('epitable') %>%
extract2('nrow')
df_nested %>%
filter(dept %in% list_depts) %>%
extract2('epitable')[[1]]
df_nested %>%
filter(dept %in% list_depts) %>%
extract2('epitable') %$dep_san%
extract2
df_nested %>%
filter(dept %in% list_depts) %>%
extract2('epitable')
df_nested %>%
filter(dept %in% list_depts) %>%
extract2('epitable') %>%
extract2(1)
df_nested %>%
filter(dept %in% list_depts) %>%
extract2('epitable') %>%
extract2(1) %>%
nrow
df_nested %>%
filter(dept %in% list_depts) %>%
extract2('epitable') %>%
extract(1) %>%
nrow
df_nested %>%
filter(dept %in% list_depts) %>%
extract2('epicurve_by_day_all') %>%
extract2(1) %>%
nrow
df_nested %>%
filter(dept %in% list_depts) %>%
extract2('epicurve_by_day_all') %>%
extract2(1)
DisplayResult <- function(variable) df_nested %>% filter(dept %in% list_depts) %>% extract2(variable) %>% extract2(1)
DisplayResult('epicurve_by_day_all')[[1]][[1]]
DisplayResult('epicurve_by_day_all')
nrow(DisplayResult('epitable'))
if(nrow(DisplayResult('epitable'))>1) {rws <- seq(1, nrow(DisplayResult('epitable')) - 1, by = 2)}
DisplayResult('pie_cases_by_commune')
DisplayResult('epitable')
DisplayResult('data')
DisplayResult('data')$date
DisplayResult('epicurve_by_week_inst')
library(tidyverse)
source('functions.R')
list_depts <-
list_db_paths[str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')] %>%
str_replace_all(c('data/' = '', '[-_]Surveillance Cholera.*' = ''))
list_db_paths <- dir('data', full.names = TRUE)
list_depts <-
list_db_paths[str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')] %>%
str_replace_all(c('data/' = '', '[-_]Surveillance Cholera.*' = ''))
df_nested <-
list_depts %>%
map(WrangleData) %>%
bind_rows() %>%
nest(-c(dept), .key = data_by_age) %>%
mutate(
# data sets
data = map(data_by_age, MergeAges),
data_pie = map(data_by_age, WrangleDataPie, variable = 'cas_vus'),
data_map = map2(data, dept, WrangleDataMapPopAR),
# table
epitable = map(data, MakeTable),
# plots
## epicurves
epicurve_by_day_all = map(data, PlotHistDay),
# epicurve_by_week_all = map(data, PlotHistWeek),
epicurve_by_week_commune = map(data, PlotHistWeekCommune),
epicurve_by_week_inst = map(data, PlotHistWeekInst),
## proportion plots
pie_cases_by_commune = map(data_pie, PlotPie, colour_scheme = 'RdBu', key = 'commune'),
bar_cases_by_commune = map(data_pie, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune'),
## map
map = map(data_map, MakeMapAR)
)
list_depts <-
list_db_paths[str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')] %>%
str_replace_all(c('data/' = '', '[-_]Surveillance Cholera.*' = ''))
list_depts
source('functions.R')
list_db_paths <- dir('data', full.names = TRUE)
list_depts <-
list_db_paths[str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')] %>%
str_replace_all(c('data/' = '', '[-_]Surveillance Cholera.*' = ''))
df_nested <-
list_depts %>%
map(WrangleData) %>%
bind_rows() %>%
nest(-c(dept), .key = data_by_age) %>%
mutate(
# data sets
data = map(data_by_age, MergeAges),
data_pie = map(data_by_age, WrangleDataPie, variable = 'cas_vus'),
data_map = map2(data, dept, WrangleDataMapPopAR),
# table
epitable = map(data, MakeTable),
# plots
## epicurves
epicurve_by_day_all = map(data, PlotHistDay),
# epicurve_by_week_all = map(data, PlotHistWeek),
epicurve_by_week_commune = map(data, PlotHistWeekCommune),
epicurve_by_week_inst = map(data, PlotHistWeekInst),
## proportion plots
pie_cases_by_commune = map(data_pie, PlotPie, colour_scheme = 'RdBu', key = 'commune'),
bar_cases_by_commune = map(data_pie, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune'),
## map
map = map(data_map, MakeMapAR)
)
library(readxl)
df_nested <-
list_depts %>%
map(WrangleData) %>%
bind_rows() %>%
nest(-c(dept), .key = data_by_age) %>%
mutate(
# data sets
data = map(data_by_age, MergeAges),
data_pie = map(data_by_age, WrangleDataPie, variable = 'cas_vus'),
data_map = map2(data, dept, WrangleDataMapPopAR),
# table
epitable = map(data, MakeTable),
# plots
## epicurves
epicurve_by_day_all = map(data, PlotHistDay),
# epicurve_by_week_all = map(data, PlotHistWeek),
epicurve_by_week_commune = map(data, PlotHistWeekCommune),
epicurve_by_week_inst = map(data, PlotHistWeekInst),
## proportion plots
pie_cases_by_commune = map(data_pie, PlotPie, colour_scheme = 'RdBu', key = 'commune'),
bar_cases_by_commune = map(data_pie, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune'),
## map
map = map(data_map, MakeMapAR)
)
library(lubridate)
df_nested <-
list_depts %>%
map(WrangleData) %>%
bind_rows() %>%
nest(-c(dept), .key = data_by_age) %>%
mutate(
# data sets
data = map(data_by_age, MergeAges),
data_pie = map(data_by_age, WrangleDataPie, variable = 'cas_vus'),
data_map = map2(data, dept, WrangleDataMapPopAR),
# table
epitable = map(data, MakeTable),
# plots
## epicurves
epicurve_by_day_all = map(data, PlotHistDay),
# epicurve_by_week_all = map(data, PlotHistWeek),
epicurve_by_week_commune = map(data, PlotHistWeekCommune),
epicurve_by_week_inst = map(data, PlotHistWeekInst),
## proportion plots
pie_cases_by_commune = map(data_pie, PlotPie, colour_scheme = 'RdBu', key = 'commune'),
bar_cases_by_commune = map(data_pie, PlotBar, colour_scheme = 'RdBu', facet_var = 'commune'),
## map
map = map(data_map, MakeMapAR)
)
DisplayResult('epicurve_by_day_all')
library(magrittr)
DisplayResult('epicurve_by_day_all')
DisplayResult('pie_cases_by_commune')
save.image("~/OneDrive/who/projects/2016_haiti/ws.RData")
tidyverse_update()
install.packages(c("curl", "ggrepel", "ggthemes"))
packrat::init()
packrat::init()
packrat::repos_list()
packrat::snapshot()
packrat::init()
system.Date
packrat::init()
packrat::snapshot()
packrat::init()
packrat::init()
packrat::init()
packrat::off()
