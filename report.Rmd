---
output:
  tufte::tufte_handout:
    latex_engine: pdflatex
    pandoc_args: [
      '--include-in-header', 'styles.sty', 
      '--include-before-body', 'titlepage.tex'
    ]
  tufte::tufte_html: default
link-citations: yes
subtitle: Situation epidemiologique
params:
  dep_san: DSGA
header-includes:
   - \usepackage{pdflscape}
---

```{r, cache=FALSE, message=FALSE, echo=FALSE, warning=FALSE, results='hide'}
knitr::opts_chunk$set(cache=FALSE, message=FALSE, echo=FALSE, warning=FALSE, results='asis')
knitr::knit_hooks$set(inline = function(x) if (is.numeric(x)) round(x, 1) )

list_depts <- params$dep_san

library(readxl)
library(stringr)
library(dplyr)
library(tidyr)
library(purrr)
library(lubridate)
library(ggplot2)
library(viridis)

source('functions.R')

# list data sheets to be read in (all communes per dept)
list_db_paths <- dir('data', full.names = TRUE)
# list_depts <-
  # list_db_paths[str_detect(list_db_paths, 'Surveillance Cholera_2015_2016')] %>% 
  # str_replace_all(c('data/' = '', '[-_]Surveillance Cholera.*' = ''))

list_dat_post_hurr <- map(list_depts, WrangleDataCTC) %>% set_names(list_depts)

# plot by day
list_hist_post_hurr_day <- map(list_dat_post_hurr, PlotHistDayPostHurrCTC) %>% set_names(list_depts)

# by week & inst
list_hist_post_hurr_week_inst <- map(list_dat_post_hurr, PlotHistWeekCommunePostHurrCTC)

# tables
list_table_post_hurr_CTC <- map(list_dat_post_hurr, MakeTablePostHurrCTC)  
```

-	Analyse base de données de diarrhées aigues sévères de la Grand’Anse
-	Investigation de décès institutionnels a Dame Marie, Recherche active communautaire et reponse
-	Evaluation de la qualité des données cholera a Dame Marie, Chambellan et Moron

# Analyse des données de diarrhées aigues:

```{r, fig.fullwidth = TRUE, fig.cap = paste0("Tendance des cas de diarrhées aigues, ", list_dat_post_hurr[[list_depts]]$date %>% min %>% format('%d %b %Y'), " - ", list_dat_post_hurr[[list_depts]]$date %>% max %>% format('%d %b %Y'), " Grand’Anse (données partielles).")}
list_hist_post_hurr_day[[list_depts]]
```

\newpage

\begin{fullwidth}
\makeatletter\setlength\hsize{\@tufte@fullwidth}\setlength\linewidth{\@tufte@fullwidth}\let\caption\@tufte@orig@caption\makeatother
\footnotesize
```{r, tab_overview}
if(nrow(list_table_post_hurr_CTC[[list_depts]])>1) {rws <- seq(1, nrow(list_table_post_hurr_CTC[[list_depts]]) - 1, by = 2)}

# col <- rep("\\rowcolor{whoblue!15}", length(rws))

list_table_post_hurr_CTC[[list_depts]] %>% 
  xtable::xtable(
    caption = paste0("Répartition des cas de diarrhées aigues par CTC/UTC, ", list_dat_post_hurr[[list_depts]]$date %>% min %>% format('%d %b %Y'), " - ", list_dat_post_hurr[[list_depts]]$date %>% max %>% format('%d %b %Y'), " Grand’Anse (données partielles)."), 
    digits = 0, label = "tab_overview", align = 'lllrrrr'
  ) %>% 
  print(booktabs = TRUE, caption.placement = "top", add.to.row = list(pos = as.list(rws), command = rep("\\rowcolor{whoblue!15}", length(rws))), include.rownames = FALSE, comment = FALSE, tabular.environment = 'longtable', floating = FALSE)
```
\end{fullwidth}

